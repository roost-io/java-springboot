# Test generated by RoostGPT for test dm-artillery-test using AI Type Azure Open AI and AI Model roost-gpt4-32k

# RoostTestHash=70199667a6

config:
  target: "{{ $processEnvironment.API_HOST }}"
  plugins:
    expect: {}
  http:
    pool: 10
  phases:
    - duration: 60
      arrivalRate: 5
scenarios:
  - name: 'Test API with Failure cases'
    flow:
      - log: 'Sending request with invalid URL'
        get:
          url: '/invalidURL'
          headers:
            Authorization: "Bearer INVALID_TOKEN"
          expect:
            #let's expect 404 status code as the URL is invalid and the test should fail.
            - statusCode: 404
            # Expecting header 'content-type' in the response
            - hasHeader: 'content-type'
          log: 'Expecting 404 status and content-type header'
      - think: 3
      
      - log: 'Sending Incorrect Authorization'
        get:
          url: '/products'
          headers:
            Authorization: "Bearer INVALID_TOKEN"
          expect:
            #It's an invalid token so expecting 401 unauthorised status code and content type as json.
            - statusCode: 401
            - hasHeader: 'Content-Type'
            - contentType: 'application/json'
            - bodyContains:
              - 'Unauthorized access'
          log: 'Expecting 401 status, content-type header, content-type to be JSON, and to contain unauthorized error in the reponse body'
      - think: 3
      
      - log: 'Sending request without required headers'
        get:
          url: '/products'
          expect:
            #- should fail because headers are mainly required (in an actual API you cannot make request without necessary header).
            - statusCode: 400 
          log: 'Expecting 400 status because it was sent without required headers'
      - think: 3
      
      - log: 'Sending request to correct endpoint with invalid HTTP method'
        post:
          url: '/products'
          headers:
            Authorization: "{{ $processEnvironment.AUTH_TOKEN }}"
          expect:
            # method not allowed for retrive operation, expecting 405 error code.
            - statusCode: 405
          log: 'Expecting 405 status code as POST method is not allowed on this endpoint'
